import {parseWithParentheses} from './parser_rev2.mjs'

// Basic principles taken from https://mozilla.github.io/calculator/test/
// Note that this is not nearly a complete test suite
const testMap = {
    "3500": "3500",
    "3": "3",
    "12.1": "12.1",
    "19.9999": "19.9999",
    "35.999": "35.999",
    "-5": "-5",
    "5": "5",
    "1.2*10^9": "1200000000",
    "1.8*10^9": "1800000000",
    "1.0*10^9": "1000000000",
    "-0.5": "-0.5",
    "-500+500": "0",
    "20": "20",
    "-500+0.25": "-499.75",
    "-500+1.23456789": "-498.76543211",
    "-500+123456789": "123456289",
    "-500": "-500",
    "6": "6",
    "-3": "-3",
    "-3.25": "-3.25",
    "-500-500": "-1000",
    "12-8": "4",
    "8.35": "8.35",
    "7.65": "7.65",
    "-1.06": "-1.06",
    "4.9124691": "4.9124691",
    "989.01": "989.01",
    "-10": "-10",
    "-25": "-25",
    "-500-33.12": "-533.12",
    "-3.33": "-3.33",
    "-87530865": "-87530865",
    "4.91246913": "4.91246913",
    "-500-12.3456789": "-512.3456789",
    "-500-123456789": "-123457289",
    "3000000": "3000000",
    "12": "12",
    "9696": "9696",
    "3.636": "3.636",
    "0.161196": "0.161196",
    "-3000000": "-3000000",
    "-500*1.23": "-615",
    "-500*123": "-61500",
    "12*8": "96",
    "2.60478583": "2.60478583",
    "-500*123456789": "-61728394500",
    "-500*123.456789": "-61728.3945",
    "0.75": "0.75",
    "0": "0",
    "-0.75": "-0.75",
    "-0.6246": "-0.6246",
    "-1.60102466": "-1.60102466",
    "1.40333333": "1.40333333",
    "3.20204931": "3.20204931",
    "0.0749279539": "0.0749279539",
    "500/3.12": "160.25641025641025",
    "500/312": "1.602564102564103",
    "12/8": "1.5",
    "0.585137503": "0.585137503",
}

let fails = 0
for (const [input, expected] of Object.entries(testMap)) {
    try {
        let result = parseWithParentheses(input, 0, 0)[0].toNumber().toLocaleString('en-UK', {
            maximumFractionDigits: 15,
            minimumFractionDigits: 0,
            useGrouping: false
        })
        if (result !== expected) {
            console.log(`Test failed: ${input} should be ${expected} but was ${result}`)
            fails++
        }
    } catch (error) {
        console.log(`Test failed: ${input} should be ${expected} but threw ${error}`)
        fails++
    }
}

if (fails === 0) {
    console.log("All tests passed!")
} else {
    console.log(`${fails} tests failed!`)
}
